%%% ======= Beamer ======
\documentclass[usenames,dvipsnames,t]{beamer}
% \documentclass[usenames,dvipsnames, handout]{beamer}
\beamertemplatenavigationsymbolsempty % remove toolbar at the bottom of slides
\usepackage{appendixnumberbeamer} % for appendix
\usetheme{Madrid}
\usecolortheme{default}
\useinnertheme{circles}

\usepackage{fontawesome}

% Define commands for social media icons with links
\newcommand{\twitter}{\href{https://twitter.com/ThibeauWouters}{\textcolor{black}{\faTwitter}}}
\newcommand{\linkedin}{\href{https://www.linkedin.com/in/ThibeauWouters}{\textcolor{black}{\faLinkedin}}}
\newcommand{\github}{\href{https://github.com/ThibeauWouters}{\textcolor{black}{\faGithub}}}

\newcommand{\thetaeos}{\boldsymbol{\theta}_{\rm{EOS}}}
\newcommand{\boldtheta}{\boldsymbol{\theta}}

\setbeamercolor{author in head/foot}{bg=blue!10, fg=blue}
\setbeamercolor{title in head/foot}{bg=blue!10, fg=blue}
\setbeamercolor{date in head/foot}{bg=blue!10, fg=blue}

\makeatletter
\setbeamertemplate{footline}{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor\expandafter\ifblank\expandafter{\beamer@shortinstitute}{}{~~(\insertshortinstitute)}
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}\insertshorttitle
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,right]{date in head/foot}%
    \usebeamerfont{date in head/foot}\insertshortdate{}\hspace*{2em}
    \insertframenumber{}%
%     / \inserttotalframenumber
    \hspace*{2ex} 
  \end{beamercolorbox}}%
  \vskip0pt%
}
\makeatother

% Show the TOC at the beginning
\AtBeginSection[]{
  \addtocounter{framenumber}{-1}
  \begin{frame}
      \frametitle{Contents}
      \tableofcontents[currentsection,subsectionstyle=shaded/shaded/hide]
  \end{frame}
}


\colorlet{beamer@blendedblue}{blue!70} % change color theme

\usepackage[style=numeric-comp,sorting=none,backend=biber]{biblatex}%<- specify style
\addbibresource{references.bib}%<- specify bib file

\usepackage{svg}


% For appendix
\newcommand{\backupbegin}{
   \newcounter{framenumberappendix}
   \setcounter{framenumberappendix}{\value{framenumber}}
}
\newcommand{\backupend}{
   \addtocounter{framenumberappendix}{-\value{framenumber}}
   \addtocounter{framenumber}{\value{framenumberappendix}} 
}

\setbeamertemplate{bibliography item}{\insertbiblabel} % improved references



% Other preamble stuff:
\usepackage{preamble}

%%% Uncomment for another color palette
% \definecolor{Logo1}{rgb}{0.0, 0, 0.7}
% \definecolor{Logo2}{rgb}{2.55, 2.55, 2.55}

% \setbeamercolor*{palette primary}{bg=Logo1, fg=white}
% \setbeamercolor*{palette secondary}{bg=Logo2, fg=white}
% \setbeamercolor*{palette tertiary}{bg=white, fg=Logo1}
% \setbeamercolor*{palette quaternary}{bg=white,fg=white}
% \setbeamercolor{structure}{fg=Logo1} % itemize, enumerate, etc
% \setbeamercolor{section in toc}{fg=Logo1} % TOC sections

% For figures
\usepackage{import}
\usepackage{xifthen}
\usepackage{pdfpages}
\usepackage{transparent}
\usepackage{mdframed}
\usepackage{subcaption}

\setbeamertemplate{caption}[numbered]



% --- Inkscape figures:
\newcommand{\incfig}[2][0.75\textwidth]{%
    \def\svgwidth{\columnwidth}
    \resizebox{#1}{!}{\import{Inkscape figs/}{#2.pdf_tex}}
}

% --- Height of frame
\newlength{\myheight}
\setlength{\myheight}{7cm}

\newlength\myheightfigureintext
\newlength\mydepthfigureintext
\settototalheight\myheightfigureintext{Xygp}
\settodepth\mydepthfigureintext{Xygp}
\setlength\fboxsep{0pt}


%------------------------------------------------------------
%This block of code defines the information to appear in the
%Title page
\title[\textsc{jester}] %optional
{Leveraging Differentiable Programming in the Inverse Problem of Neutron Stars}

\author[Thibeau Wouters]{\small{\textbf{Thibeau Wouters}, Peter T. H. Pang, Rahul Somasundaram, Ingo Tews, Tim Dietrich, and Chris Van Den Broeck} \\ \vspace{2mm} \href{mailto:t.r.i.wouters@uu.nl}{t.r.i.wouters@uu.nl} \newline \github \quad \linkedin \quad \twitter}


\date{Extreme Matter 17/03/2025}



%End of title page configuration block
%------------------------------------------------------------



%------------------------------------------------------------
%The next block of commands puts the table of contents at the 
%beginning of each section and highlights the current section:

%------------------------------------------------------------


\begin{document}

{

\usebackgroundtemplate{\transparent{0.15}{\includegraphics[width=\paperwidth,height=\paperheight]{Figures/GW-2.jpeg}}}

\begin{frame}[plain]
\titlepage

\begin{columns}
  \column{0.35\textwidth}
  \begin{figure}
    \centering
    \vspace{1.5mm}
    \includegraphics[width=0.75\linewidth]{Figures/utrecht-university.png}
  \end{figure}
  \column{0.35\textwidth}
  \begin{figure}
    \centering
    \includegraphics[width=0.75\linewidth]{Figures/Nikhef_logo-transparent.png}
  \end{figure}
\end{columns}


%%% as subfigures
% \begin{figure}
%   \centering
%   \begin{subfigure}[b]{0.475\textwidth}
%     \centering
%     \includegraphics[width=0.6\textwidth]{Figures/utrecht-university.png}
%   \end{subfigure}
%   \caption*{}
%   \hfill
%   \begin{subfigure}[b]{0.475\textwidth}
%     \centering
%     \includegraphics[width=0.6\textwidth]{Figures/Nikhef_logo-transparent.png}
%   \end{subfigure}
%   \caption*{}
%   % \caption*{}
% \end{figure}

\end{frame}
}

% %The next statement creates the title page.
% \frame[plain]{\titlepage



% }


%---------------------------------------------------------
%This block of code is for the table of contents after
%the title page
% \begin{frame}[plain, noframenumbering]
% \frametitle{Table of Contents}
% \tableofcontents
% \end{frame}
%---------------------------------------------------------


\begin{frame}{Introduction}
  \def\x{2mm}

  % Neutron stars (NSs) offer unique probes of the high-density regime of the equation of state (EOS) of dense nuclear matter.

  
  \red{Inverse problem of neutron stars}: infer the equation of state (EOS) of dense nuclear matter from observations of neutron stars (NSs): masses, radii, tidal deformabilities, \dots
  
  \vspace{\x}

  Bottleneck: solving Tolman-Oppenheimer-Volkoff (TOV) equations

  \vspace{\x}

  \begin{figure}
    \centering
    \includegraphics[width=0.75\linewidth]{Figures/Koehn_EOS.jpg}
  \end{figure}

\end{frame}


\begin{frame}{Inverting neutron stars with differentiable programming}
  \def\x{3mm}
  \def\y{7mm}
  \def\z{10mm}

  Our solution: \red{differentiable programming} with \textsc{jax}~\cite{frostig2018compiling}
  \begin{itemize}
    \vspace{\x}
    
    \item GPU accelerators -- no emulators required!
    
    \vspace{\x}
    \item Automatic differentiation to compute gradients of code
  \end{itemize}

  \vspace{\y}

  We efficiently invert neutron stars with
  \begin{enumerate}
    \vspace{\x}

    \item \textbf{Bayesian inference}: using NS data to constrain EOS parameters

    \vspace{\x}

    \item \textbf{Gradient-based optimizers}: efficient inversion of $R(M)$ or $\Lambda(M)$
  \end{enumerate}

  \vspace{\z}
  
  Available open source: \textsc{jester} (\href{https://github.com/tsunhopang/jester}{{\faGithub \texttt{tsunhopang/jester}}})
\end{frame}

\begin{frame}{Methods -- Equation of state parametrization (1)}

  \def\x{3mm}
    
  \begin{itemize}
    \item At \red{low density}, we use the metamodel~\cite{Margueron:2017eqc,Margueron:2017lup}: Taylor expansion of energy per nucleon $E/A$ in\footnote{$n_{\rm{sat}} \equiv 0.16 \ \rm{fm}^{-3}$} $x = (n - n_{\rm{sat}}) / 3n_{\rm{sat}}$
    % , ${\rho_{\rm{sat}} \equiv 2.7 \times 10^{14} \ \rm{g} \ \rm{cm}^{-3}}$

    \vspace{\x}

    \item \red{Nuclear empirical parameters} (NEPs): coefficients of the expansion
  \end{itemize}

  \vspace{\x}

  \begin{equation*}
    E/A(n, \delta) = e_{\rm{sat}}(n) + e_{\rm{sym}}(n) \delta^2  + \mathcal{O}(\delta^4) \, , \quad \delta = (n_n - n_p) / n \,
  \end{equation*}

  \begin{align*}
    e_{\rm{sat}}(n) &= E_{\rm{sat}} + \tfrac12 K_{\rm{sat}} x^2 + \tfrac{1}{3!} Q_{\rm{sat}} x^3 + \tfrac{1}{4!} Z_{\rm{sat}} x^4 + \mathcal{O}(x^5) \\
    e_{\rm{sym}}(n) &= E_{\rm{sym}} + L_{\rm{sym}} x + \tfrac12 K_{\rm{sym}} x^2  \\
    & \quad + \tfrac{1}{3!} Q_{\rm{sym}} x^3 + \tfrac{1}{4!} Z_{\rm{sym}} x^4 + \mathcal{O}(x^5)
  \end{align*}

\end{frame}

\begin{frame}{Methods -- Equation of state parametrization (2)}

  \def\x{3mm}
  \def\y{1mm}
    
  \begin{itemize}
    \item Metamodel description breaks down at $\red{n_{\rm{break}}} \sim [1, 2] \ n_{\rm{sat}}$

    \vspace{\x}
    
    \item \red{Higher density}: parametrize the EOS with $c_s^2(n)$ grid points and linear interpolation~\cite{Somasundaram:2021clp}
    
  \end{itemize}
  
  \vspace{\y}

  \begin{figure}
    \centering
    \includegraphics[width=0.65\linewidth]{Figures/cs2_sketch.pdf}
  \end{figure}
\end{frame}

% \begin{frame}{Methods -- Bayesian inference}

%   \def\x{5mm}
%   \def\y{1mm}

%   Goal: \red{posterior} with MCMC from NS data $d$ % $\red{p(\theta_{\rm{EOS}} | d)}$
%   \begin{equation*}
%       \red{p(\theta_{\rm{EOS}} | d)} \propto p(d | \theta_{\rm{EOS}}) p(\theta_{\rm{EOS}})
%   \end{equation*}

%   \vspace{\x}

%   Computationally expensive: solve TOV equations for many $\theta_{\rm{EOS}}$!

%   \begin{itemize}
%     \vspace{\y}
%     \item \texttt{JAX}: compiles code, runs on GPU
    
%     \vspace{\y}
%     \item \texttt{flowMC}~\cite{Gabrie:2021tlu,Wong:2022xvh}: MCMC with normalizing flows as proposal distributions
%   \end{itemize}

%   \vspace{\x}

%   With this, we achieve (on NVIDIA H100 GPU)
%   \begin{itemize}
%     \vspace{\y}
%     \item $\sim 0.24$ ms per TOV solver call
    
%     \vspace{\y}
%     \item $\sim 1$ h for MCMC run
%   \end{itemize}
% \end{frame}

\section{Bayesian inference}

\begin{frame}{Results -- Bayesian inference}

  \def\x{2mm}
  \def\y{2mm}

  \begin{itemize}
    \item EOS constraints: nuclear theory ($\chi_{\rm{EFT}}$), NS observations (heavy PSRs, NICER, GW170817)

    \vspace{\y}

    \item Extend Koehn \textit{et al.}~\cite{Koehn:2024set}: directly sample $\theta_{\rm{EOS}}$

    \vspace{\y}

    \item $\sim 0.24$ ms per TOV solver call, \red{$\sim 1$ h} for MCMC run (H100 GPU)

    \vspace{\y}

    \item Scales well with number of parameters (more $c_s^2(n)$ grid points)
  \end{itemize}

  % \vspace{\x}

  \begin{columns}

    \column{0.5\textwidth}

    \begin{figure}[htpb]
      \centering
      \includegraphics[width=0.975\linewidth]{Figures/R14_table.jpg}
    \end{figure}

    \column{0.5\textwidth}
    \begin{figure}[htpb]
      \centering
      \includegraphics[width=0.975\linewidth]{Figures/scaling_plot.pdf}
    \end{figure}

  \end{columns}

\end{frame}


\begin{frame}{Results -- Measuring $n_{\rm{break}}$}

  \def\x{2mm}
  \def\y{2mm}

  $\chi_{\rm{EFT}}$ predicts metamodel to break down at a density $n_{\rm{break}} \sim 1-2 \ n_{\rm{sat}}$ 
  Can we determine this with NSs?

  \begin{itemize}
    \vspace{\y}
    \item Wide, agnostic prior on $n_{\rm{break}}$: $U(1, 4) \ n_{\rm{sat}}$

    \vspace{\y}
    \item Only consider heavy PSRs, NICER, GW170817

    % \vspace{\y}
    % \item Infer $n_{\rm{break}} = 2.47_{-1.02}^{+1.53} \ n_{\rm{sat}}$ ($90\%$)
  \end{itemize}

  \vspace{\x}

  \begin{figure}
    \centering
    \includegraphics[width=0.55\linewidth]{Figures/nbreak_posterior.pdf}
  \end{figure}

\end{frame}

\section{Gradient-based optimization}

\begin{frame}{Methods -- Gradient-based optimization}

  \def\x{2mm}

  \begin{itemize}
    % \item Alternative to Bayesian inference: optimization with gradients

    % \vspace{\x}

    \item Given $\hat{\Lambda}_i$: ``true'' tidal deformabilities at masses $M_i$ to invert

    \vspace{\x}
    
    \item Loss function $L(\thetaeos)$: relative error in tidal deformability $\Lambda$
    
    \vspace{\x}

    \item Gradient descent: $\boldtheta^{(i+1)} \leftarrow \boldtheta^{(i)} - \gamma \nabla L(\boldtheta^{(i)})$ with Adam
    
    \begin{itemize}
      \item Automatic differentation! % $\nabla \Lambda(\boldtheta_{\rm{EOS}})$? 
    \end{itemize}

  \end{itemize}

  \vspace{-3mm}

  \begin{columns}

    \column{0.45\textwidth}

    \small
    \begin{equation*}
      L(\thetaeos) = \frac1N \sum_{i=1}^N \left| \frac{\Lambda_i(\thetaeos) - \hat{\Lambda}_i}{\hat{\Lambda}_i} \right|
    \end{equation*}

    \normalsize

    \column{0.60\textwidth}

    \begin{figure}[htpb]
      \centering
      \includegraphics[width=1.0\linewidth]{Figures/showcase_variational_inference.pdf}
    \end{figure}

  \end{columns}
\end{frame}

\begin{frame}{Results -- Recovery of nuclear empirical parameters}

  \def\x{3mm}
  \def\y{2mm}

  What do NSs tell us about nuclear empirical parameters (NEPs)?

  \vspace{\y}

  \begin{itemize}
    \item ``True'' EOS: only NEPs -- no $c_s^2(n)$ grid points

    \vspace{\x}

    \item Recover with increasingly more NEPs being varied

    \vspace{\x}

    \item If more NEPs are varied, $L_{\rm{sym}}$ is no longer constrained

    \vspace{\x}
    
    \item Recovered EOSs deviate $<100$ meters, $<10$ in $\Lambda$ from the true EOS -- observationally indistinguishable % in $[1, 2] \ M_\odot$ range
  \end{itemize}

  \begin{figure}
    \centering
    \includegraphics[width=1.0\linewidth]{Figures/money_plot.pdf}
  \end{figure}
\end{frame}

\begin{frame}{Conclusion}

  \def\x{5mm}
  \def\y{7mm}

  \begin{itemize}
    \item We have developed \textsc{jester}, a differentiable programming framework for the inverse problem of NSs

    \vspace{\x}

    \item We demonstrate accurate and scalable Bayesian inference on NS data

    \vspace{\x}

    \item Gradient-based optimizers can efficiently invert a complete NS family

    \vspace{\x}

    \item New tool to gain insights into how NSs probe the EOS
  \end{itemize}

  \vspace{\y}

  Available open source: \textsc{jester} (\href{https://github.com/tsunhopang/jester}{{\faGithub \texttt{tsunhopang/jester}}})
\end{frame}

\begin{frame}[allowframebreaks]{References}
  \printbibliography
\end{frame}

\appendix

\begin{frame}{More validation results}


  \begin{figure}
    \centering
    \includegraphics[width=\linewidth]{Figures/Untitled.jpg}
  \end{figure}
\end{frame}




\end{document}

